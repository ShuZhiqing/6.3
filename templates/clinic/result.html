{% extends 'base.html' %}

{% load static %}

{% block content %}
    {% autoescape off %}
        <link rel="stylesheet" type="text/css" href="{% static 'css/autocomplete.css' %}"/>
        <script src="http://maps.google.com/maps/api/js?key=AIzaSyBGtxox2T1OKH_lnf-XPDnS7D9cZAkfZvU&"
                type="text/javascript"></script>
        <script src='//cdn.jsdelivr.net/gmaps4rails/2.1.2/gmaps4rails.js' type="text/javascript"></script>
        <script src='//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore.js'
                type="text/javascript"></script>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script>

            $(function () {
                var asc = function (a, b) {
                    return eval($(a).find('input').val()) > eval($(b).find('input').val()) ? 1 : -1;
                }
                var desc = function (a, b) {
                    return eval($(a).find('input').val()) > eval($(b).find('input').val()) ? -1 : 1;
                }
                var sortByInput = function (sortBy) {
                    var sortEle = $('.sf-map-results>div').sort(sortBy);
                    $('.sf-map-results').empty().append(sortEle);
                }
                $('#desc').click(function () {
                    sortByInput(desc);
                });
                $('#asc').click(function () {
                    sortByInput(asc);
                });
            })

            $(function () {
                var asc = function (a, b) {
                    return eval($(a).find('label').text()) > eval($(b).find('label').text()) ? 1 : -1;
                }
                var desc = function (a, b) {
                    return eval($(a).find('label').text()) > eval($(b).find('label').text()) ? -1 : 1;
                }
                var sortByInput = function (sortBy) {
                    var sortEle = $('.sf-map-results>div').sort(sortBy);
                    $('.sf-map-results').empty().append(sortEle);
                }
                $('#wdesc').click(function () {
                    sortByInput(desc);
                });
                $('#wasc').click(function () {
                    sortByInput(asc);
                });
            })

            function switchIcon() {
                var descIcon = document.getElementById('desc');
                var ascIcon = document.getElementById('asc');

                if (descIcon && descIcon.style.display == 'none') {
                    descIcon.style.display = 'inline-block';
                } else {
                    descIcon.style.display = 'none';
                }

                if (ascIcon && ascIcon.style.display == 'none') {
                    ascIcon.style.display = 'inline-block';
                } else {
                    ascIcon.style.display = 'none';
                }
            }

            function switchIcon2() {
                var descIcon = document.getElementById('wdesc');
                var ascIcon = document.getElementById('wasc');

                if (descIcon && descIcon.style.display == 'none') {
                    descIcon.style.display = 'inline-block';
                } else {
                    descIcon.style.display = 'none';
                }

                if (ascIcon && ascIcon.style.display == 'none') {
                    ascIcon.style.display = 'inline-block';
                } else {
                    ascIcon.style.display = 'none';
                }
            }
        </script>


        <div class="container-body style-6">

                <div class="bc-icons-2 text-uppercase" style="margin-left: 7.5%;margin-right: 7.5%; margin-top: 20px">
                <ol class="breadcrumb indigo lighten-4" style="padding-top: 0px">
                    <li class="breadcrumb-item"><a class="black-text" href="{% url 'home' %}#top"><strong>Home</strong></a><i
                            class="fa fa-caret-right mx-2" aria-hidden="true"></i></li>
                    <li class="breadcrumb-item active">Search Result</li>
                </ol>
            </div>
        <h4></h4>


            <div class="sf-map-container">
            <div class="row tm-banner-row" id="tm-section-search-result">
            <form action="{% url 'result' %}" method="POST" class="tm-search-form tm-section-pad-2"
                  autocomplete="off" onsubmit="return checkLocation()" name="myForm" id="myForm">
                {% csrf_token %}
                <div class="form-row tm-search-form-row">
                    <div class="form-group tm-form-group tm-form-group-pad tm-form-group-1" style="width: 100%;">
                        <label for="inputLocation">My Location</label>
                        <button type="button" id="locatee"
                                style="border: none; background-color: #f5f6f6; color: #17a2b8">
                            <i class="fa fa-map-marker"></i>
                            Use Current Location
                        </button>
                    </div>
                </div>
                <div class="form-row tm-search-form-row">
                    <div class="form-group tm-form-group tm-form-group-pad tm-form-group-1" style="width: 100%;">
                        <div class="autocomplete" style="min-width: 320px;">
                            <input name="destination" type="text" class="form-control"
                                   id="inputLocation" style="box-shadow:none; text-align: left;"
                                   placeholder="Suburb and postcode" required="True"
                                   value="{{ input_obj.destination.value }}">
                            <span id="checkInput"></span>
                        </div>
                    </div>
                </div>
                <div class="form-row tm-search-form-row" >
                        <div class="form-group tm-form-group tm-form-group-pad tm-form-group-1">
                            <label for="inputLanguage1">Preferred Language</label>
                            <select name="language" class="form-control tm-select" id="inputLanguage1">
                                <option value="English" selected>English</option>
                                <option value="Arabic">Arabic</option>
                                <option value="French">French</option>
                                <option value="Hakka">Hakka</option>
                                <option value="Hindi">Hindi</option>
                                <option value="Indonesian">Indonesian</option>
                                <option value="Kannada">Kannada</option>
                                <option value="Macedonian">Macedonian</option>
                                <option value="Malayalam">Malayalam</option>
                                <option value="Mandarin">Mandarin</option>
                                <option value="Marathi">Marathi</option>
                                <option value="Persian">Persian</option>
                                <option value="Polish">Polish</option>
                                <option value="Punjabi">Punjabi</option>
                                <option value="Russian">Russian</option>
                                <option value="Tamil">Tamil</option>
                                <option value="Thai">Thai</option>
                                <option value="Telugu">Telugu</option>
                                <option value="Urdu">Urdu</option>
                                <option value="Vietnamese">Vietnamese</option>
                            </select>
                        </div>
                        <div class="form-group tm-form-group tm-form-group-pad tm-form-group-1">
                            <label for="inputLanguage2">Second Language</label>
                            <select name="language2" class="form-control tm-select" id="inputLanguage2">
                                <option value="English" selected>English</option>
                                <option value="Arabic">Arabic</option>
                                <option value="French">French</option>
                                <option value="Hakka">Hakka</option>
                                <option value="Hindi">Hindi</option>
                                <option value="Indonesian">Indonesian</option>
                                <option value="Kannada">Kannada</option>
                                <option value="Macedonian">Macedonian</option>
                                <option value="Malayalam">Malayalam</option>
                                <option value="Mandarin">Mandarin</option>
                                <option value="Marathi">Marathi</option>
                                <option value="Persian">Persian</option>
                                <option value="Polish">Polish</option>
                                <option value="Punjabi">Punjabi</option>
                                <option value="Russian">Russian</option>
                                <option value="Tamil">Tamil</option>
                                <option value="Thai">Thai</option>
                                <option value="Telugu">Telugu</option>
                                <option value="Urdu">Urdu</option>
                                <option value="Vietnamese">Vietnamese</option>
                            </select>
                        </div>
                    </div>

                <div class="form-row tm-search-form-row" >
                    <div class="form-group tm-form-group tm-form-group-pad tm-form-group-1" >
                        <label for="inputDistance">Distance</label>
                        <select name="distance" class="form-control tm-select" id="inputDistance">
                            <option value="5" selected>Within 5km</option>
                            <option value="10">Within 10km</option>
                            <option value="20">Within 20km</option>
                            <option value="30">Within 30km</option>
                            <option value="40">Within 40km</option>
                            <option value="50">Within 50km</option>
                        </select>
                    </div>
                    <div class="form-group tm-form-group tm-form-group-pad tm-form-group-1">
                        <label for="inputGroup">Group</label>
                        <select name="group" class="form-control tm-select" id="inputGroup">
                            <option value="All ages" selected>All ages</option>
                            <option value="Children only">Children only</option>
                            <option value="Aboriginal and Torres Strait Islanders only">Aboriginal and
                                Torres Strait Islanders only
                            </option>
                        </select>
                    </div>
                </div>
                <div class="form-row tm-search-form-row">
                    <div class="form-group tm-form-group tm-form-group-pad tm-form-group-1">
                        <label for="btnSubmit"></label>
                        <button type="submit"
                                class="btn btn-primary tm-btn tm-btn-search text-uppercase"
                                id="btnSubmit">Search Clinic
                        </button>
                    </div>
                </div>
            </form>
        </div> <!-- row -->
            <div class="results-sort" style="flex-direction: column">
                <ul id="nav" >
                <button type="button" class="btn btn-default" onclick="switchIcon()" style="min-width: 80px; margin-bottom: 10px;"">
                    <span id="desc" class="pull-left" style="display: inline-block;"><i
                            class="fa fa-sort-amount-asc"></i>Distance</span>
                    <span id="asc" class="pull-left" style="display:none;"> <i
                            class="fa fa-sort-amount-desc"></i>Distance</span>
                </button>
                <button type="button" class="btn btn-default" onclick="switchIcon2()" style="min-width: 80px;margin-bottom: 10px;">
                    <span id="wdesc" class="pull-left" style="display: inline-block;"><i
                            class="fa fa-sort-amount-asc"></i>Waiting Time</span>
                    <span id="wasc" class="pull-left" style="display:none;"> <i
                            class="fa fa-sort-amount-desc"></i>Waiting Time</span>
                </button>
            </ul>
                <div class="sf-map-sidebar">
                    {% if not error_msg %}
                        <div class="sf-map-results">
                            {% for query in queryset_list %}
                                <div id="{{ query.name }}" class="sf-map-result-container" style="border: none;">
                                    <span id="{{ query.address }}" class="sf-map-result-label"></span>
                                    <span class="sf-map-result-title">{{ query.name }}</span><br>
                                    <span class="sf-map-result-waitinglist" style="font-weight: bolder;color: #17a2b8;">Approximate Waiting Time: {{ query.waitingTime }} months</span><br>
                                    <label style="display:none">{{ query.waitingTime }} </label>
                                    <span class="sf-map-result-addr"> <i class="fa fa-map-marker"
                                                                         style="color: #818182"></i> {{ query.address }}</span><br>
                                    <span class="sf-map-result-language"> <i class="fa fa-language"
                                                                             style="color: #818182;font-size: inherit;" ></i> {{ query.language }}</span><br>
                                    <span class="sf-map-result-group"><i class="fa fa-group"
                                                                         style="color: #818182"></i> {{ query.group }}</span><br>
                                    <span class="sf-map-result-phone"><i class="fa fa-phone"
                                                                         style="color: #818182"></i> {{ query.phone }}</span><br>

                                    <span class="sf-map-result-phone">Distance: {{ query.distance }} Km</span><br>
                                    <input type="text" value="{{ query.distance }}" style="display:none">
                                    <span id="{{ query.id }}"></span>
                                    <i class="fa fa-calendar-o" style="color: #818182"
                                       data-html="true"
                                       data-toggle="tooltip"
                                       title="<strong>Opening Hour</strong><br>
                                       Monday: {{ query.monday }} <br>
                                       Tuesday: {{ query.tuesday }}<br>
                                       Wednesday: {{ query.wednesday }}<br>
                                       Thursday: {{ query.thursday }}<br>
                                       Friday: {{ query.friday }}<br>
                                       Saturday: {{ query.saturday }}<br>
                                       Sunday: {{ query.sunday }}"
                                       data-placement="right"></i><br>
                                    <button type="button" class="btn btn-info"
                                            onclick="window.open('{{ query.website }}')">
                                        <i class="fa fa-globe" style="font-size: inherit" title="Website"></i> Read More
                                    </button>
                                    <button type="button" class="btn btn-info"
                                            onclick="window.open('http://maps.google.com/maps?saddr=' + clocation() + '&daddr={{ query.lat }},{{ query.lng }}&hl=en&dirflg=r')">
                                        <i class="fa fa-arrow-circle-right" title="direction"></i> Go there
                                    </button>
                                </div>
                            {% endfor %}
                        </div>

                    {% elif error_msg %}
                        <h3>Sorry, we could not found your preferred results. But we list 10 nearest clinics for
                            you.</h3>
                        <div class="sf-map-results">
                            {% for query in clinic_list|slice:"10" %}
                                <div id="{{ query.name }}" class="sf-map-result-container" style="border: none;">
                                    <span id="{{ query.address }}" class="sf-map-result-label"></span>
                                    <span class="sf-map-result-title">{{ query.name }}</span><br>
                                    <span class="sf-map-result-waitinglist" style="font-weight: bolder;color: #17a2b8;">Approximate Waiting Time: {{ query.waitingTime }} months</span><br>
                                    <label style="display:none">{{ query.waitingTime }} </label>
                                    <span class="sf-map-result-addr"> <i class="fa fa-map-marker"
                                                                         style="color: #818182"></i> {{ query.address }}</span><br>
                                    <span class="sf-map-result-language"> <i class="fa fa-language"
                                                                             style="color: #818182;font-size: inherit;"></i> {{ query.language }}</span><br>
                                    <span class="sf-map-result-group"><i class="fa fa-group"
                                                                         style="color: #818182"></i> {{ query.group }}</span><br>
                                    <span class="sf-map-result-phone"><i class="fa fa-phone"
                                                                         style="color: #818182"></i> {{ query.phone }}</span><br>

                                    <span class="sf-map-result-phone">Distance: {{ query.distance }} Km</span><br>
                                    <input type="text" value="{{ query.distance }}" style="display:none">
                                    <span id="{{ query.id }}"></span>
                                    <i class="fa fa-calendar-o" style="color: #818182"
                                       data-html="true"
                                       data-toggle="tooltip"
                                       title="<strong>Opening Hour</strong><br>
                                       Monday: {{ query.monday }} <br>
                                       Tuesday: {{ query.tuesday }}<br>
                                       Wednesday: {{ query.wednesday }}<br>
                                       Thursday: {{ query.thursday }}<br>
                                       Friday: {{ query.friday }}<br>
                                       Saturday: {{ query.saturday }}<br>
                                       Sunday: {{ query.sunday }}"
                                       data-placement="right"></i><br>
                                    <button type="button" class="btn btn-info"
                                            onclick="window.open('{{ query.website }}')">
                                        <i class="fa fa-globe" id="globe-img" style="font-size: inherit;" title="Website"></i> Read More
                                    </button>
                                    <button type="button" class="btn btn-info"
                                            onclick="window.open('http://maps.google.com/maps?saddr=' + clocation() + '&daddr={{ query.lat }},{{ query.lng }}&hl=en&dirflg=r')">
                                        <i class="fa fa-arrow-circle-right" title="direction"></i> Go there
                                    </button>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            </div>

                <div class="sf-map-view" id="map">
                    <div style="width: 100%;height: 100%; margin: 0px; padding: 0px; position: relative;"></div>

                    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
                    <script type="text/javascript">


                        {#var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';#}
                        {#var labels2 = '123456789'#}
                        {#var labelIndex = 0;#}
                        {#var labelIndex2 = 0;#}
                        var curlat = parseFloat({{ destination.lat }});
                        var curlng = parseFloat({{ destination.lng }});
                        var map, infoWindow;
                        var marker;
                        var clicked = false;
                        var pMarkerId = '';
                        {#var labelInfo = [];#}
                        {#var labelInfo2 = [];#}
                        var markers = [];

                        map = new google.maps.Map(document.getElementById('map'), {
                            zoom: 11,
                            center: new google.maps.LatLng(curlat, curlng),
                            mapTypeId: google.maps.MapTypeId.ROADMAP
                        });

                        infoWindow = new google.maps.InfoWindow();

                        {% if not error_msg %}

                            {% for query in queryset_list %}

                                function calender() {
                                    lat = position.coords.latitude;
                                    lng = position.coords.longitude;
                                }

                                marker = new google.maps.Marker({
                                    position: new google.maps.LatLng({{ query.lat }}, {{ query.lng }}),
                                    {#label: labels[labelIndex++ % labels.length],#}
                                    map: map,
                                });
                                markers.push(marker);

                                {#labelInfo.push(marker.label);#}
                                {#document.getElementById("{{ query.address }}").innerHTML = labelInfo[{{ forloop.counter }}-1];#}
                                document.getElementById("{{ query.address }}").style.fontFamily = "arial";
                                {#document.getElementById("{{ query.address }}").style.fontSize = "25px";#}
                                document.getElementById("{{ query.address }}").style.color = "#69c6ba"

                                google.maps.event.addListener(marker, 'click', (function (marker) {
                                    return function () {
                                        if (clicked) {
                                            document.getElementById(pMarkerId).style.border = 'none';
                                            clicked = false;
                                        }
                                        infoWindow.setContent("<strong>" + "{{ query.name }}" + "</strong><br>"
                                            {#"{{ query.address }}"#}
                                            {#+ '<br>' + "Languages: " + "{{ query.language }}"#}
                                            {#+ '<br>'#}
                                            {#+ '<br>' + "Opening Hours" +#}
                                            {#'<br>' + "Monday: " + "{{ query.monday }}" +#}
                                            {#'<br>' + "Tuesday: " + "{{ query.tuesday }}" +#}
                                            {#'<br>' + "Wednesday: " + "{{ query.wednesday }}" +#}
                                            {#'<br>' + "Thursday: " + "{{ query.thursday }}" +#}
                                            {#'<br>' + "Friday: " + "{{ query.friday }}" +#}
                                            {#'<br>' + "Saturday: " + "{{ query.saturday }}" +#}
                                            {#'<br>' + "Sunday: " + "{{ query.sunday }}"#}
                                        );
                                        infoWindow.open(map, marker);
                                        map.setZoom(15);
                                        document.getElementById("{{ query.name }}").style.border = 'solid #69c6ba';
                                        document.getElementById("{{ query.name }}").scrollIntoView();
                                        clicked = true;
                                        pMarkerId = "{{ query.name }}";
                                        var latLng = marker.getPosition(); // returns LatLng object
                                        map.setCenter(latLng);
                                    }
                                })(marker));

                                document.getElementById("{{ query.name }}").onclick = function () {
                                    if (clicked) {
                                        document.getElementById(pMarkerId).style.border = 'none';
                                        clicked = false;
                                    }
                                    infoWindow.setContent("<strong>" + "{{ query.name }}" + "</strong><br>"
                                        {#"{{ query.address }}"#}
                                        {#+ '<br>' + "Languages: " + "{{ query.language }}"#}
                                        {#+ '<br>'#}
                                        {#+ '<br>' + "Opening Hours" +#}
                                        {#'<br>' + "Monday: " + "{{ query.monday }}" +#}
                                        {#'<br>' + "Tuesday: " + "{{ query.tuesday }}" +#}
                                        {#'<br>' + "Wednesday: " + "{{ query.wednesday }}" +#}
                                        {#'<br>' + "Thursday: " + "{{ query.thursday }}" +#}
                                        {#'<br>' + "Friday: " + "{{ query.friday }}" +#}
                                        {#'<br>' + "Saturday: " + "{{ query.saturday }}" +#}
                                        {#'<br>' + "Sunday: " + "{{ query.sunday }}"#}
                                    );
                                    infoWindow.open(map, markers[{{ forloop.counter }}-1]);
                                    document.getElementById("{{ query.name }}").style.border = 'solid #69c6ba';
                                    clicked = true;
                                    pMarkerId = "{{ query.name }}";
                                    var latLng = markers[{{ forloop.counter }}-1].getPosition(); // returns LatLng object
                                    map.setCenter(latLng);
                                    map.setZoom(15);
                                }
                            {% endfor %}
                        {% else %}
                            {% for query in clinic_list|slice:"10" %}
                                marker = new google.maps.Marker({
                                    position: new google.maps.LatLng({{ query.lat }}, {{ query.lng }}),
                                    {#label: labels[labelIndex++ % labels.length],#}
                                    map: map,
                                });
                                markers.push(marker);

                                {#labelInfo.push(marker.label);#}
                                {#document.getElementById("{{ query.address }}").innerHTML = labelInfo[{{ forloop.counter }}-1];#}
                                document.getElementById("{{ query.address }}").style.fontFamily = "arial";
                                {#document.getElementById("{{ query.address }}").style.fontSize = "25px";#}
                                document.getElementById("{{ query.address }}").style.color = "#69c6ba"

                                google.maps.event.addListener(marker, 'click', (function (marker) {
                                    return function () {
                                        if (clicked) {
                                            document.getElementById(pMarkerId).style.border = 'none';
                                            clicked = false;
                                        }
                                        infoWindow.setContent("<strong>" + "{{ query.name }}" + "</strong><br>"
                                            {#"{{ query.address }}"#}
                                            {#+ '<br>' + "Languages: " + "{{ query.language }}"#}
                                            {#+ '<br>'#}
                                            {#+ '<br>' + "Opening Hours" +#}
                                            {#'<br>' + "Monday: " + "{{ query.monday }}" +#}
                                            {#'<br>' + "Tuesday: " + "{{ query.tuesday }}" +#}
                                            {#'<br>' + "Wednesday: " + "{{ query.wednesday }}" +#}
                                            {#'<br>' + "Thursday: " + "{{ query.thursday }}" +#}
                                            {#'<br>' + "Friday: " + "{{ query.friday }}" +#}
                                            {#'<br>' + "Saturday: " + "{{ query.saturday }}" +#}
                                            {#'<br>' + "Sunday: " + "{{ query.sunday }}"#}
                                        );
                                        infoWindow.open(map, marker);
                                        map.setZoom(15);
                                        document.getElementById("{{ query.name }}").style.border = 'solid #69c6ba';
                                        document.getElementById("{{ query.name }}").scrollIntoView();
                                        clicked = true;
                                        pMarkerId = "{{ query.name }}";
                                        var latLng = marker.getPosition(); // returns LatLng object
                                        map.setCenter(latLng);
                                    }
                                })(marker));

                                document.getElementById("{{ query.name }}").onclick = function () {
                                    if (clicked) {
                                        document.getElementById(pMarkerId).style.border = 'none';
                                        clicked = false;
                                    }
                                    infoWindow.setContent("<strong>" + "{{ query.name }}" + "</strong><br>"
                                        {#"{{ query.address }}"#}
                                        {#+ '<br>' + "Languages: " + "{{ query.language }}"#}
                                        {#+ '<br>'#}
                                        {#+ '<br>' + "Opening Hours" +#}
                                        {#'<br>' + "Monday: " + "{{ query.monday }}" +#}
                                        {#'<br>' + "Tuesday: " + "{{ query.tuesday }}" +#}
                                        {#'<br>' + "Wednesday: " + "{{ query.wednesday }}" +#}
                                        {#'<br>' + "Thursday: " + "{{ query.thursday }}" +#}
                                        {#'<br>' + "Friday: " + "{{ query.friday }}" +#}
                                        {#'<br>' + "Saturday: " + "{{ query.saturday }}" +#}
                                        {#'<br>' + "Sunday: " + "{{ query.sunday }}"#}
                                    );
                                    infoWindow.open(map, markers[{{ forloop.counter }}-1]);
                                    document.getElementById("{{ query.name }}").style.border = 'solid #69c6ba';
                                    clicked = true;
                                    pMarkerId = "{{ query.name }}";
                                    var latLng = markers[{{ forloop.counter }}-1].getPosition(); // returns LatLng object
                                    map.setCenter(latLng);
                                    map.setZoom(15);
                                }
                            {% endfor %}

                        {% endif %}



                        google.maps.event.addListener(infoWindow, 'closeclick', function () {
                            map.setZoom(12);
                            {#map.setCenter(curlat,curlng);#}
                            var elements = document.getElementsByClassName('sf-map-result-container'), i, len;
                            for (i = 0, len = elements.length; i < len; i++) {
                                elements[i].style.border = '#fff';
                            }
                            {#let test = document.getElementsByClassName('sf-map-result-container');#}
                            document.getElementById(elements[0].id).scrollIntoView();
                        });


                        if (navigator.geolocation) {
                            navigator.geolocation.getCurrentPosition(function (position) {
                                var currentLocation = {
                                    lat: position.coords.latitude,
                                    lng: position.coords.longitude
                                };
                                var current = new google.maps.Marker({
                                    position: new google.maps.LatLng(currentLocation.lat, currentLocation.lng),
                                    map: map,
                                    icon: {
                                        url: "http://maps.google.com/mapfiles/ms/icons/blue-pushpin.png"
                                    }
                                });

                            }, function () {
                                handleLocationError(true, infoWindow, map.getCenter());
                            });
                        } else {
                            // Browser doesn't support Geolocation
                            handleLocationError(false, infoWindow, map.getCenter());
                        }

                        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                            infoWindow.setPosition(pos);
                            infoWindow.setContent(browserHasGeolocation ?
                                'Error: The Geolocation service failed.' :
                                'Error: Your browser doesn\'t support geolocation.');
                            infoWindow.open(map);
                        }

                        var lat;
                        var lng;
                        if (navigator.geolocation) {
                            navigator.geolocation.getCurrentPosition(showPosition);
                        }

                        function showPosition(position) {
                            lat = position.coords.latitude;
                            lng = position.coords.longitude;
                        }

                        //get location
                        $(function () {
                            $('#locatee').click(function (event) {
                                event.preventDefault();

                                $('#inputLocation').val("Finding locat" +
                                    "ion...");
                                // check if browser supports the geolocation api
                                if (navigator.geolocation) {
                                    navigator.geolocation.getCurrentPosition(success);			// if geolocation supported, call function
                                } else {
                                    $("#inputLocation").val('Your browser doesn\'t support.');
                                }
                            });
                        })

                        // function to get lat/long and plot on a google map
                        function success(position) {

                            var geocoder = new google.maps.Geocoder;
                            var latitude = position.coords.latitude;		    // set latitude variable
                            var longitude = position.coords.longitude;			// set longitude variable
                            /*var latLongResponse = latitude + ',' + longitude;*/
                            /*var latlngStr = latLongResponse.split(',', 2);*/
                            var latlng = {lat: parseFloat(latitude), lng: parseFloat(longitude)};
                            var formatted_address = '';
                            var suburb = '';
                            geocoder.geocode({'location': latlng}, function (results, status) {
                                if (status === 'OK') {
                                    if (results[0]) {

                                        formatted_address = results[0].formatted_address;
                                        var match = /.*,\s(.*)\sVIC\s(\d+)[,]\sAustralia/.exec(formatted_address);
                                        if (match != null) {
                                            suburb = match[1] + ", " + match[2];
                                            $("#inputLocation").val(suburb);
                                        } else {
                                            $("#inputLocation").val("Location Not Found");
                                        }
                                    } else {
                                        window.alert('No results found');
                                    }
                                }
                            });
                        }


                        function clocation() {
                            var location = lat + "," + lng
                            return location;
                        }

                        {% if not error_msg %}
                            {% for query in queryset_list %}
                                var date = new Date();
                                var day = date.getDay();
                                switch (day) {
                                    case 0:
                                        var status = getStatus("{{ query.sunday }}");
                                        switch (status) {
                                            case "Open Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "green";
                                                break;
                                            case "Closed Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "red";
                                                break;
                                            default:
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.fontWeight = "bold";
                                        }
                                        break;
                                    case 1:
                                        var status = getStatus("{{ query.monday }}");
                                        switch (status) {
                                            case "Open Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "green";
                                                break;
                                            case "Closed Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "red";
                                                break;
                                            default:
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.fontWeight = "bold";
                                        }
                                        //Monday
                                        break;
                                    case 2:
                                        var status = getStatus("{{ query.tuesday }}");
                                        switch (status) {
                                            case "Open Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "green";
                                                break;
                                            case "Closed Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "red";
                                                break;
                                            default:
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.fontWeight = "bold";
                                        }
                                        //Tuesday
                                        break;
                                    case 3:
                                        var status = getStatus("{{ query.wednesday }}");
                                        switch (status) {
                                            case "Open Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "green";
                                                break;
                                            case "Closed Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "red";
                                                break;
                                            default:
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.fontWeight = "bold";
                                        }
                                        //Wednesday
                                        break;
                                    case 4:
                                        var status = getStatus("{{ query.thursday }}");
                                        switch (status) {
                                            case "Open Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "green";
                                                break;
                                            case "Closed Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "red";
                                                break;
                                            default:
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.fontWeight = "bold";
                                        }
                                        //Thursday
                                        break;
                                    case 5:
                                        var status = getStatus("{{ query.friday }}");
                                        switch (status) {
                                            case "Open Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "green";
                                                break;
                                            case "Closed Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "red";
                                                break;
                                            default:
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.fontWeight = "bold";
                                        }
                                        //Friday
                                        break;
                                    case 6:
                                        var status = getStatus("{{ query.saturday }}");
                                        switch (status) {
                                            case "Open Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "green";
                                                break;
                                            case "Closed Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "red";
                                                break;
                                            default:
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.fontWeight = "bold";
                                        }
                                        //Saturday
                                        break;
                                }
                            {% endfor %}
                        {% else %}
                            {% for query in clinic_list|slice:"10" %}
                                var date = new Date();
                                var day = date.getDay();
                                switch (day) {
                                    case 0:
                                        var status = getStatus("{{ query.sunday }}");
                                        switch (status) {
                                            case "Open Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "green";
                                                break;
                                            case "Closed Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "red";
                                                break;
                                            default:
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.fontWeight = "bold";
                                        }
                                        break;
                                    case 1:
                                        var status = getStatus("{{ query.monday }}");
                                        switch (status) {
                                            case "Open Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "green";
                                                break;
                                            case "Closed Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "red";
                                                break;
                                            default:
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.fontWeight = "bold";
                                        }
                                        //Monday
                                        break;
                                    case 2:
                                        var status = getStatus("{{ query.tuesday }}");
                                        switch (status) {
                                            case "Open Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "green";
                                                break;
                                            case "Closed Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "red";
                                                break;
                                            default:
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.fontWeight = "bold";
                                        }
                                        //Tuesday
                                        break;
                                    case 3:
                                        var status = getStatus("{{ query.wednesday }}");
                                        switch (status) {
                                            case "Open Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "green";
                                                break;
                                            case "Closed Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "red";
                                                break;
                                            default:
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.fontWeight = "bold";
                                        }
                                        //Wednesday
                                        break;
                                    case 4:
                                        var status = getStatus("{{ query.thursday }}");
                                        switch (status) {
                                            case "Open Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "green";
                                                break;
                                            case "Closed Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "red";
                                                break;
                                            default:
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.fontWeight = "bold";
                                        }
                                        //Thursday
                                        break;
                                    case 5:
                                        var status = getStatus("{{ query.friday }}");
                                        switch (status) {
                                            case "Open Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "green";
                                                break;
                                            case "Closed Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "red";
                                                break;
                                            default:
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.fontWeight = "bold";
                                        }
                                        //Friday
                                        break;
                                    case 6:
                                        var status = getStatus("{{ query.saturday }}");
                                        switch (status) {
                                            case "Open Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "green";
                                                break;
                                            case "Closed Now":
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.color = "red";
                                                break;
                                            default:
                                                document.getElementById("{{ query.id }}").innerHTML = status;
                                                document.getElementById("{{ query.id }}").style.fontWeight = "bold";
                                        }
                                        //Saturday
                                        break;
                                }
                            {% endfor %}
                        {% endif %}

                        function getStatus(datestring) {
                            if (datestring == "24 hours") {
                                return "Open Now";
                            }
                            else if (datestring == "Closed") {
                                return "Closed Now";
                            }
                            else if (datestring.search(":") != -1) {
                                var now = new Date();
                                var start = new Date();
                                var end = new Date();
                                start.setSeconds(0);
                                end.setSeconds(0);
                                start.setHours(parseInt(datestring.match(/\d{2}:\d{2}/gm)[0].split(":")[0]));
                                start.setMinutes(parseInt(datestring.match(/\d{2}:\d{2}/gm)[0].split(":")[1]));
                                end.setHours(parseInt(datestring.match(/\d{2}:\d{2}/gm)[1].split(":")[0]));
                                end.setMinutes(parseInt(datestring.match(/\d{2}:\d{2}/gm)[1].split(":")[1]));
                                if ((start <= now) & (now <= end)) {
                                    return "Open Now";
                                }
                                else {
                                    return "Closed Now";
                                }

                            }
                            else {
                                return datestring;
                            }
                        }

                        function completeList() {
                            document.getElementById("inputLanguage1").value = '{{ input_obj.language.value }}';
                            document.getElementById("inputLanguage2").value = '{{ input_obj.language2.value }}';
                            document.getElementById("inputDistance").value = '{{ input_obj.distance.value }}';
                            document.getElementById("inputGroup").value = '{{ input_obj.group.value }}';
                        }

                        completeList();

                        function autocomplete(inp, arr) {
                            /*the autocomplete function takes two arguments,
                            the text field element and an array of possible autocompleted values:*/
                            var currentFocus;

                            /*execute a function when someone writes in the text field:*/
                            inp.addEventListener("input", function (e) {
                                var a, b, i, val = this.value;
                                /*close any already open lists of autocompleted values*/
                                closeAllLists();
                                if (!val) {
                                    return false;
                                }
                                currentFocus = -1;
                                /*create a DIV element that will contain the items (values):*/
                                a = document.createElement("DIV");
                                a.setAttribute("id", this.id + "autocomplete-list");
                                a.setAttribute("class", "autocomplete-items");
                                /*append the DIV element as a child of the autocomplete container:*/
                                this.parentNode.appendChild(a);
                                /*for each item in the array...*/
                                /*var height = document.createAttribute("class");*/
                                /*height.value = "max-height: 10000px;";*/
                                for (i = 0; i < arr.length; i++) {
                                    /*check if the item starts with the same letters as the text field value:*/
                                    if (arr[i].substr(arr[i].indexOf(val.toUpperCase()), val.length).toUpperCase() == val.toUpperCase()) {
                                        /*create a DIV element for each matching element:*/
                                        b = document.createElement("DIV");
                                        /*make the matching letters bold:*/
                                        b.innerHTML = "<strong>" + arr[i].substr(arr[i].indexOf(val.toUpperCase()), val.length) + "</strong>";
                                        b.innerHTML = arr[i].replace(arr[i].substr(arr[i].indexOf(val.toUpperCase()), val.length), b.innerHTML);
                                        /*insert a input field that will hold the current array item's value:*/
                                        b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                                        /*execute a function when someone clicks on the item value (DIV element):*/
                                        b.addEventListener("click", function (e) {
                                            /*insert the value for the autocomplete text field:*/
                                            inp.value = this.getElementsByTagName("input")[0].value;
                                            /*close the list of autocompleted values,
                                            (or any other open lists of autocompleted values:*/
                                            closeAllLists();
                                        });
                                        a.appendChild(b);
                                    }
                                }
                            });
                            /*execute a function presses a key on the keyboard:*/
                            inp.addEventListener("keydown", function (e) {
                                var x = document.getElementById(this.id + "autocomplete-list");
                                if (x) x = x.getElementsByTagName("div");
                                if (e.keyCode == 40) {
                                    /*If the arrow DOWN key is pressed,
                                    increase the currentFocus variable:*/
                                    currentFocus++;
                                    /*and and make the current item more visible:*/
                                    addActive(x);
                                } else if (e.keyCode == 38) { //up
                                    /*If the arrow UP key is pressed,
                                    decrease the currentFocus variable:*/
                                    currentFocus--;
                                    /*and and make the current item more visible:*/
                                    addActive(x);
                                } else if (e.keyCode == 13) {
                                    /*If the ENTER key is pressed, prevent the form from being submitted,*/
                                    e.preventDefault();
                                    if (currentFocus > -1) {
                                        /*and simulate a click on the "active" item:*/
                                        if (x) x[currentFocus].click();
                                    }
                                }
                            });

                            function addActive(x) {
                                /*a function to classify an item as "active":*/
                                if (!x) return false;
                                /*start by removing the "active" class on all items:*/
                                removeActive(x);
                                if (currentFocus >= x.length) currentFocus = 0;
                                if (currentFocus < 0) currentFocus = (x.length - 1);
                                /*add class "autocomplete-active":*/
                                x[currentFocus].classList.add("autocomplete-active");
                            }

                            function removeActive(x) {
                                /*a function to remove the "active" class from all autocomplete items:*/
                                for (var i = 0; i < x.length; i++) {
                                    x[i].classList.remove("autocomplete-active");
                                }
                            }

                            function closeAllLists(elmnt) {
                                /*close all autocomplete lists in the document,
                                except the one passed as an argument:*/
                                var x = document.getElementsByClassName("autocomplete-items");
                                for (var i = 0; i < x.length; i++) {
                                    if (elmnt != x[i] && elmnt != inp) {
                                        x[i].parentNode.removeChild(x[i]);
                                    }
                                }
                            }

                            /*execute a function when someone clicks in the document:*/
                            document.addEventListener("click", function (e) {
                                closeAllLists(e.target);
                            });

                        }

                        function Address() {

                            /*An array containing all the country names in the world:*/
                            var address = [];
                            {% for item in address %}
                                address.push('{{ item.address }}')
                            {% endfor %}

                            this.getAddress = function () {
                                return address;
                            }
                        }

                        var address = new Address();

                        /*initiate the autocomplete function on the "inputLocation" element, and pass along the countries array as possible autocomplete values:*/
                        autocomplete(document.getElementById("inputLocation"), address.getAddress());

                        function checkLocation() {
                            var check = false;
                            var location = document.getElementById("inputLocation").value;

                            if (!(address.getAddress().includes(location.toUpperCase()))) {
                                check = false;
                                document.getElementById("checkInput").innerHTML = "Wrong address, please check whether the information of suburb and postcode is correct";
                                document.getElementById("checkInput").style.color = "red";
                            } else {
                                check = true;
                            }
                            return check;
                        }

                        window.oninput = function checkInput() {
                            document.getElementById("checkInput").innerHTML = "";
                        }
                    </script>

                </div>

            </div>

        </div>
    {% endautoescape %}

{% endblock %}